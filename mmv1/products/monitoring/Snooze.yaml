# Copyright 2024 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

--- !ruby/object:Api::Resource
# API resource name
name: 'Snooze'
# Resource description for the provider documentation.
description: |
  A Snooze will prevent any alerts from being opened, and close any that are already open.
  The Snooze will work on alerts that match the criteria defined in the Snooze.
  The Snooze will be active from interval start time through interval end time.


  ~> **Note:** Monitoring Snoozes cannot be deleted from the Google Cloud Platform.
  Destroying a Terraform-managed Snooze will cancel the snooze and remove it from state but
  *will not delete the resource from the project.*
references: !ruby/object:Api::Resource::ReferenceLinks
  guides:
    'Official Documentation': 'https://cloud.google.com/monitoring/alerts/snooze'
  api: 'https://cloud.google.com/monitoring/api/ref_v3/rest#rest-resource:-v3.projects.snoozes'
# Marks the resource as beta-only. Ensure a beta version block is present in
# provider.yaml.
# min_version: beta

# URL for the resource's standard List method. https://google.aip.dev/132
# Terraform field names enclosed in double curly braces are replaced with
# the field values from the resource at runtime.
base_url: 'v3/projects/{{project}}/snoozes'
self_link: 'v3/{{name}}'
create_url: 'v3/projects/{{project}}/snoozes'
update_verb: :PATCH
update_mask: true
id_format: '{{name}}'
import_format: ['{{name}}']
custom_code: !ruby/object:Provider::Terraform::CustomCode
  custom_import: templates/terraform/custom_import/self_link_as_name.erb
  post_create: templates/terraform/post_create/set_computed_name.erb
examples:
  - !ruby/object:Provider::Terraform::Examples
    # A snooze can be cancelled but cannot be deleted therefore autogenerated tests fail,
    # with a dangling resources error. The hand written tests confirm the snooze has been 
    # cancelled and removed from state.
    skip_test: true
    name: 'monitoring_snooze_basic'
    primary_resource_id: 'snooze'
    vars:
      snooze_display_name: 'My Snooze'
      alert_policy_resource_id: alert_policy
      alert_policy_display_name: 'My Alert Policy'
properties:
  - !ruby/object:Api::Type::String
    name: name
    description: |
      The unique resource name for this Snooze.
      Its syntax is: projects/[PROJECT_ID_OR_NUMBER]/snoozes/[SNOOZE_ID]
    output: true
  - !ruby/object:Api::Type::String
    name: 'displayName'
    description: |
      A short name or phrase used to identify the Snooze. 
      The display name is limited to 512 Unicode characters.
    required: true
  - !ruby/object:Api::Type::NestedObject
    name: 'criteria'
    description: |
      This defines the criteria for applying the Snooze
    required: true
    properties:
      - !ruby/object:Api::Type::Array
        name: 'policies'
        item_type: Api::Type::String
        description: |
          The specific AlertPolicy names for the alert that should be snoozed.
          The format is: `projects/[PROJECT_ID_OR_NUMBER]/alertPolicies/[POLICY_ID]`
          There is a limit of 16 policies per snooze.
  - !ruby/object:Api::Type::NestedObject
    name: 'interval'
    description: |
      The Snooze will be active from interval.start_time through interval.end_time.
      The interval.start_time cannot be in the past.
    required: true
    properties:
      - !ruby/object:Api::Type::String
        name: "startTime"
        description: |
          The beginning of the time interval. The default value for the start time is the end time.
          The start time must not be later than the end time.
          A timestamp in RFC3339 UTC "Zulu" format, with nanosecond resolution and up to nine fractional digits.
          Examples: "2014-10-02T15:01:23Z" and "2014-10-02T15:01:23.045123456Z".
      - !ruby/object:Api::Type::String
        name: "endTime"
        required: true
        description: |
          The end of the time interval.
          A timestamp in RFC3339 UTC "Zulu" format, with nanosecond resolution and up to nine fractional digits.
          Examples: "2014-10-02T15:01:23Z" and "2014-10-02T15:01:23.045123456Z".
